FIRST PART:
Very easy

SECOND PART:
at first dirty hack, thousands of lines of copy

then cross join with generated series
had to modify the window function
had to order the result at the end
